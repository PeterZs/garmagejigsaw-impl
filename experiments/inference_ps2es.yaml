MODEL_NAME: jigsaw_StyleXD
MODULE: jigsaw_stylexd

PROJECT: jigsaw

DATASET: stylexd.all_piece_matching

# best is pipline4/V6_E59.ckpt
WEIGHT_FILE: pretrained/pipline4/V6_E59.ckpt

RESUME: false
WANDB:
  ID: 0v9nor32

GPUS: [0]
BATCH_SIZE: 1
NUM_WORKERS: 1

TRAIN:
  NUM_EPOCHS: 250
  LR: 0.001
  WEIGHT_DECAY: 0.
  WARMUP_RATIO: 0.
  LR_SCHEDULER: 'cosine'
  LR_DECAY: 100.
  VAL_EVERY: 5

MODEL:
  USE_POINT_FEATURE: True   # 是否提取点特征
  USE_LOCAL_POINT_FEATURE: False    # 是否提取点的局部特征
  USE_GLOBAL_POINT_FEATURE: True  # 是否提取点的全局特征
  USE_UV_FEATURE: True      # 是否提取UV特征
  USE_LOCAL_UV_FEATURE: True       # 是否提取UV的全局特征
  USE_GLOBAL_UV_FEATURE: False     # 是否提取UV的全局特征

  ENCODE_ALL_ONCE: False  # 不论使用点云、UV、或是法线特征，都使用同一个encoder提取特征

  FEATURE_CONV:
    USE_FEATURE_CONV: False
    TYPE: "default"
    LAYER_NUM: 1
    KERNEL_SIZE: 3
    DILATION: 1

  FEATURE_CONV_2:
    USE_FEATURE_CONV: False
    TYPE: "default"
    LAYER_NUM: 1
    KERNEL_SIZE: 3
    DILATION: 1

  TF_LAYER_NUM: 1  # PT层的数量
  USE_TF_BLOCK: False  # 是否将每一层 PointTransformer Layer 分别封装成一个包含残差效果的 Block
  TF:
    NORM: "batch"

  POINTCLASSIFIER:
    NORM: "batch"
  STITCHPREDICTOR:
    NORM: "batch"

  PC_CLS_THRESHOLD: 0.5
  LOSS:
    MAT_LOSS_TYPE: "global"  # "local" OR "global"
    MAT_LOSS_SYM: True       # 是否强制让用于计算损失的 gt stitching mat 是斜对称的
    w_cls_loss: 0.0
    w_mat_loss: 0.0

CALLBACK:
  CHECKPOINT_MONITOR: val/mat_f1
  CHECKPOINT_MODE: max

DATA:
  DATA_DIR: "data/stylexd_jigsaw"
  DATA_TYPES:
    INFERENCE: ["Garmage256_SL"]

  NUM_PC_POINTS: 3000
  RANDOM_SAMPLE_NUM: null

  SHUFFLE: False  # 打乱dataset

  MAX_NUM_PART: 33
  MIN_PART_POINT: 10

  PCS_SAMPLE_TYPE:  # 在Panel上采样的方式
    TRAIN: stitch
    VAL: stitch
    INFERENCE: boundary_pcs
    STITCH:
      ONLY_SAMPLE_BOUNDARY: False  # 如果为True，采样时不采样内部缝

  SHRINK_MESH:
    TRAIN: True
    VAL: False
    INFERENCE: False
  SHRINK_MESH_PARAM:
    TRAIN: 1
    VAL: 1
    INFERENCE: 1
  SHRINK_BYSTITCH:
    TRAIN: False
    VAL: False
    INFERENCE: False
  SHRINK_BYSTITCH_STRENGTH:
    TRAIN: 0
    VAL: 0
    INFERENCE: 0

  PCS_NOISE_TYPE: default  # default  normal
  PCS_NOISE_STRENGTH: 0.
  USE_STITCH_NOISE: False  # 是否沿着缝合线加噪（仅训练）
  STITCH_NOISE_STRENGTH: 1
  STITCH_NOISE_RANDOM_RANGE: [0.8, 2.2]

  PANEL_NOISE_TYPE:  # 在Panel上加噪声的类型
    TRAIN: default
    VAL: default
    INFERENCE: default
  SCALE_RANGE: 0.
  ROT_RANGE: 0.
  TRANS_RANGE: 0.

# STATS is for eval
STATS: "./results/jigsaw_4x4_128_512_250e_cosine_everyday/stats/eval"

